import socketfrom packet_creator import *from CONFIG import *import gcfrom utils import *import errnoHELLO_PACKET = '21310020ffffffffffffffffffffffffffffffffffffffffffffffffffffffff'GET_POWER_STATUS_DATA = 'd9bf76d83d66e70fae7a06d53f59b9a38c733add0b26b72b6615026fff9da1abc1d2d783b00e5595b89c5f8063facb74'POWER_OFF_DATA = '6aaebcddf12b4ee2d7319208d9031fefb653297a3d2bfd56efffb0659c6b6b760e8560ffd2afd041e13ae8e8c0ad8b42'POWER_ON_DATA = '6aaebcddf12b4ee2d7319208d9031fefb653297a3d2bfd56efffb0659c6b6b76966833b94b9e6e8059f0de76850d358e'POWER_OFF_RES = b'97c9bbe7c213c9993a6430ed71f2d9229db5c8e11d59e4293700b9c1afb8fdd6'POWER_ON_RES = b'bbdff6d70957c92fb21a34b33f0855f042e5076dfcf9f0554e54eeb487421c79'OK_RES = b'a8855aa73e57e096623c630044f7f98ce07bbee6299249f4d67bc03fe8a5369f'sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)sock.bind(("", 12345))sock.settimeout(0.5)def send_and_recv_packet():    gc.collect()    try:        sock.sendto(hex_to_byte(HELLO_PACKET), ('192.168.0.255', 54321))        data, addr = sock.recvfrom(100)    except OSError as exc:        print('Unable to Send and Receive Hello Packet ... ')        print(errno.errorcode[exc.errno])        return None, None    if data is not None:        data = byte_to_hex(data)        return data, addr    return None, Nonedef get_status():    data, addr = send_and_recv_packet()    if data is None or addr is None:        return None    gc.collect()    packet = create_packet(data, GET_POWER_STATUS_DATA, DEVICE_TOKEN)    gc.collect()    try:        sock.sendto(packet, addr)        data, addr = sock.recvfrom(100)    except OSError as exc:        print('Unable to Send and Receive Packet ... ')        print(errno.errorcode[exc.errno])        return None    if data is not None:        data = byte_to_hex(data)[64:]        if (data == POWER_ON_RES):            return True        elif (data == POWER_OFF_RES):            return False    return Nonedef set_power(value=False):    data, addr = send_and_recv_packet()    if data is None or addr is None:        return None    PACKET_DATA = POWER_OFF_DATA    if value:        PACKET_DATA = POWER_ON_DATA    gc.collect()    packet = create_packet(data, PACKET_DATA, DEVICE_TOKEN)    gc.collect()    try:        sock.sendto(packet, addr)        data, addr = sock.recvfrom(100)    except OSError as exc:        print('Unable to Send and Receive Packet ... ')        print(errno.errorcode[exc.errno])        return None    if data is not None:        data = byte_to_hex(data)[64:]        if data is not None and data == OK_RES:            return True        else:            return False    return None